<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pansol Area Map</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.css" />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
        }
        .popup .popuptext {
            visibility: hidden;
            width: 160px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -80px;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .header {
            background-color: #4285F4;
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        .search-container {
            display: flex;
            flex: 1;
            max-width: 600px;
            margin: 0 20px;
        }
        .search-box {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
            font-size: 16px;
        }
        .search-button {
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            border-left: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 0 4px 4px 0;
        }
        .map-container {
            flex: 1;
            width: 100%;
            position: relative;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .sidebar {
            width: 300px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: absolute;
            top: 60px;
            left: 10px;
            z-index: 1000;
            border-radius: 4px;
            max-height: calc(100% - 80px);
            overflow-y: auto;
        }
        .place-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .place-item:hover {
            background-color: #f5f5f5;
        }
        .place-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .place-address {
            color: #666;
            font-size: 14px;
        }
        .location-button {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            margin-top: 8px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .location-button:hover {
            background-color: #3367D6;
        }
        .popup-content {
            margin-bottom: 6px;
        }
        .amenities {
            font-size: 12px;
            margin-top: 4px;
            color: #444;
        }
        .ratings {
            color: #FFA500;
            font-weight: bold;
            margin-top: 4px;
        }
        .price-range {
            font-style: italic;
            margin-top: 4px;
            color: #008000;
        }
        .gps-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .gps-button {
            background-color: white;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 5px rgba(0,0,0,0.65);
        }
        .gps-button:hover {
            background-color: #f4f4f4;
        }
        .gps-icon {
            width: 24px;
            height: 24px;
        }
        .directions-button {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            width: 100%;
        }
        .directions-button:hover {
            background-color: #3367D6;
        }
        #distance-time {
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #4285F4;
        }
        .directions-panel {
            position: absolute;
            bottom: 20px;
            left: 10px;
            z-index: 1000;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 4px;
            width: 300px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            display: none;
        }
        .directions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .directions-title {
            font-weight: bold;
            font-size: 16px;
        }
        .close-directions {
            cursor: pointer;
            font-size: 20px;
        }
        .direction-step {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .step-icon {
            min-width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4285F4;
            color: white;
            border-radius: 50%;
            font-size: 12px;
        }
        .step-instruction {
            flex: 1;
            font-size: 14px;
        }
        .step-distance {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        .directions-summary {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            color: #4285F4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">Pansol Maps</div>
            <div class="search-container">
                <input type="text" class="search-box" placeholder="Search in Pansol area...">
                <button class="search-button">Search</button>
            </div>
        </div>
        <div class="map-container">
            <div id="map"></div>
            <div class="gps-controls">
                <button class="gps-button" id="locate-me" title="Show my location">
                    <svg class="gps-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#4285F4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
                <button class="gps-button" id="clear-route" title="Clear route" style="display: none;">
                    <svg class="gps-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#d33" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div id="directions-panel" class="directions-panel">
                <div class="directions-header">
                    <div class="directions-title">Directions</div>
                    <div class="close-directions" onclick="closeDirections()">Ã—</div>
                </div>
                <div id="directions-steps"></div>
                <div class="directions-summary">
                    <div>Total Distance: <span id="total-distance">0 km</span></div>
                    <div>Est. Time: <span id="total-time">0 min</span></div>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <div class="place-item" onclick="panToLocation(14.179855690866304, 121.1837820447193)">
                <div class="place-name">Laguna Hot Spring Resort</div>
                <div class="place-address">Pansol, Calamba, Laguna</div>
            </div>  
            <div class="place-item" onclick="panToLocation(14.179350807676604, 121.18485773727306)">
                <div class="place-name">Villa Mejia</div>
                <div class="place-address">Pansol, Calamba, Laguna</div>
            </div>
            <div class="place-item" onclick="panToLocation(14.179889853295485, 121.1861350014737)">
                <div class="place-name">Glennette's Haven Private Resort</div>
                <div class="place-address">Pansol, Calamba, Laguna</div>
            </div>
            <div class="place-item" onclick="panToLocation(14.17950049393675, 121.18694386655233)">
                <div class="place-name">Elysian Sourire Resort</div>
                <div class="place-address">Pansol, Calamba, Laguna</div>
            </div>
            <div class="place-item" onclick="panToLocation(14.180012234621406, 121.1871543967939)">
                <div class="place-name">Villa Francesca Private Resort - Pansol</div>
                <div class="place-address">Pansol, Calamba, Laguna</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize map centered on Pansol, Calamba, Laguna
        const map = L.map('map').setView([14.17904173123533, 121.18577912412782], 16);
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Variables for GPS functionality
        let userMarker = null;
        let userPosition = null;
        let routingControl = null;
        let selectedDestination = null;
        
        // Add markers for popular locations in Pansol with enhanced information
        const locations = [
            { 
                name: "Laguna Hot Spring Resort", 
                lat: 14.179855690866304, 
                lng: 121.1837820447193,
                info: "A popular hot spring resort with multiple pools and accommodations.",
                buttonText: "View Details",
                targetPage: "1_RESORT.html",
                phone: "+63 915 123 4567",
                rating: "4.5/5",
                priceRange: "â‚±3,500 - â‚±7,000 per night",
                amenities: "Swimming pools, hot springs, restaurant, karaoke, WiFi",
                capacity: "Up to 50 guests",
                openHours: "24/7"
            },
            { 
                name: "Villa Mejia", 
                lat: 14.179350807676604, 
                lng: 121.18485773727306,
                info: "Private villa with hot spring pools for family gatherings and events.",
                buttonText: "View Details",
                targetPage: "2_RESORT.html",
                phone: "+63 917 765 4321",
                rating: "4.3/5",
                priceRange: "â‚±5,000 - â‚±8,000 per night",
                amenities: "Private pool, hot spring, kitchen, BBQ area, air conditioning",
                capacity: "Up to 25 guests",
                openHours: "Check-in: 2PM, Check-out: 12NN"
            },
            { 
                name: "Glennette's Haven Private Resort", 
                lat: 14.179889853295485, 
                lng: 121.1861350014737,
                info: "Cozy private resort with natural hot spring water and event facilities.",
                buttonText: "View Details",
                targetPage: "3_RESORT.html",
                phone: "+63 919 876 5432",
                rating: "4.7/5",
                priceRange: "â‚±7,000 - â‚±12,000 per night",
                amenities: "Hot spring pool, event hall, sound system, billiards, playground",
                capacity: "Up to 40 guests",
                openHours: "Check-in: 2PM, Check-out: 12NN"
            },
            { 
                name: "Elysian Sourire Resort", 
                lat: 14.17950049393675, 
                lng: 121.18694386655233,
                info: "Modern resort offering relaxing hot springs and comfortable accommodations.",
                buttonText: "View Details",
                targetPage: "4_RESORT.html",
                phone: "+63 918 234 5678",
                rating: "4.6/5",
                priceRange: "â‚±6,500 - â‚±15,000 per night",
                amenities: "Jacuzzi, swimming pool, massage service, game room, function hall",
                capacity: "Up to 60 guests",
                openHours: "24/7 with prior reservation"
            },
            { 
                name: "Villa Francesca Private Resort - Pansol", 
                lat: 14.180012234621406, 
                lng: 121.1871543967939,
                info: "Exclusive private resort ideal for family reunions and corporate retreats.",
                buttonText: "View Details",
                targetPage: "5_RESORT.html",
                phone: "+63 916 543 2109",
                rating: "4.8/5",
                priceRange: "â‚±10,000 - â‚±18,000 per night",
                amenities: "Multiple pools, outdoor kitchen, large garden, conference room, spa",
                capacity: "Up to 80 guests",
                openHours: "Check-in: 2PM, Check-out: 12NN"
            }
        ];
        
        // Create a marker collection to manage them
        const markers = {};
        
        // Add markers to the map with interactive popups and buttons
        locations.forEach(location => {
            const marker = L.marker([location.lat, location.lng]).addTo(map);
            
            // Create popup content with button and enhanced information
            const popupContent = document.createElement('div');
            
            // Add name
            const nameElement = document.createElement('div');
            nameElement.innerHTML = `<b>${location.name}</b>`;
            nameElement.className = 'popup-content';
            popupContent.appendChild(nameElement);
            
            // Add basic info
            const infoElement = document.createElement('div');
            infoElement.textContent = location.info;
            infoElement.className = 'popup-content';
            popupContent.appendChild(infoElement);
            
            // Add phone number
            const phoneElement = document.createElement('div');
            phoneElement.textContent = `ðŸ“ž ${location.phone}`;
            phoneElement.className = 'popup-content';
            popupContent.appendChild(phoneElement);
            
            // Add ratings
            const ratingElement = document.createElement('div');
            ratingElement.textContent = `â˜… ${location.rating}`;
            ratingElement.className = 'ratings popup-content';
            popupContent.appendChild(ratingElement);
            
            // Add price range
            const priceElement = document.createElement('div');
            priceElement.textContent = `${location.priceRange}`;
            priceElement.className = 'price-range popup-content';
            popupContent.appendChild(priceElement);
            
            // Add amenities
            const amenitiesElement = document.createElement('div');
            amenitiesElement.textContent = `Amenities: ${location.amenities}`;
            amenitiesElement.className = 'amenities popup-content';
            popupContent.appendChild(amenitiesElement);
            
            // Add capacity
            const capacityElement = document.createElement('div');
            capacityElement.textContent = `Capacity: ${location.capacity}`;
            capacityElement.className = 'popup-content';
            popupContent.appendChild(capacityElement);
            
            // Add operating hours
            const hoursElement = document.createElement('div');
            hoursElement.textContent = `Hours: ${location.openHours}`;
            hoursElement.className = 'popup-content';
            popupContent.appendChild(hoursElement);
            
            // Add distance and time info element (will be populated when user location is available)
            const distanceTimeElement = document.createElement('div');
            distanceTimeElement.id = 'distance-time';
            distanceTimeElement.style.display = 'none';
            popupContent.appendChild(distanceTimeElement);
            
            // Add button that navigates to 123.html
            const buttonLink = document.createElement('a');
            buttonLink.textContent = location.buttonText;
            buttonLink.className = 'location-button';
            buttonLink.href = location.targetPage + '?resort=' + encodeURIComponent(location.name);
            popupContent.appendChild(buttonLink);
            
            // Add directions button (only shown when user location is available)
            const directionsButton = document.createElement('button');
            directionsButton.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> Get Directions';
            directionsButton.className = 'directions-button';
            directionsButton.style.display = 'none';
            directionsButton.onclick = function(e) {
                e.preventDefault();
                if (userPosition) {
                    getDirections(userPosition, [location.lat, location.lng], location.name);
                    marker.closePopup();
                } else {
                    alert('Please enable your location first by clicking the location button.');
                }
            };
            popupContent.appendChild(directionsButton);
            
            marker.bindPopup(popupContent, { maxWidth: 300 });
            
            // Add click event to show popup
            marker.on('click', function() {
                selectedDestination = {
                    latlng: [location.lat, location.lng],
                    name: location.name
                };
                this.openPopup();
                
                // Show the directions button if user location is available
                if (userPosition) {
                    popupContent.querySelector('.directions-button').style.display = 'flex';
                }
            });
            
            // Store marker for later reference
            markers[location.name] = marker;
        });
        
        // Function to get user's current location
        document.getElementById('locate-me').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userPosition = [position.coords.latitude, position.coords.longitude];
                        
                        // If marker already exists, update position, otherwise create a new one
                        if (userMarker) {
                            userMarker.setLatLng(userPosition);
                        } else {
                            userMarker = L.marker(userPosition, {
                                icon: L.divIcon({
                                    className: 'user-location-marker',
                                    html: `<div style="background-color:#4285F4; border-radius:50%; width:16px; height:16px; border:3px solid white;"></div>`,
                                    iconSize: [22, 22],
                                    iconAnchor: [11, 11]
                                })
                            }).addTo(map);
                            userMarker.bindPopup("You are here").openPopup();
                        }
                        
                        // Pan to user location
                        map.panTo(userPosition);
                        
                        // Show directions button in any open popup
                        const openPopup = document.querySelector('.leaflet-popup');
                        if (openPopup) {
                            const directionsBtn = openPopup.querySelector('.directions-button');
                            if (directionsBtn) {
                                directionsBtn.style.display = 'flex';
                            }
                        }
                    },
                    function(error) {
                        alert(`Error getting your location: ${error.message}`);
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser');
            }
        });
        
        // Function to format directions instructions nicely
        function formatInstructions(instruction) {
            // Remove HTML tags
            let cleanInstruction = instruction.replace(/<(?:.|\n)*?>/gm, '');
            
            // Capitalize first letter
            return cleanInstruction.charAt(0).toUpperCase() + cleanInstruction.slice(1);
        }
        
        // Function to close directions panel
        function closeDirections() {
            document.getElementById('directions-panel').style.display = 'none';
        }
        
        // Function to get directions from user location to resort
        function getDirections(from, to, destinationName) {
            // Clear existing route if any
            if (routingControl) {
                map.removeControl(routingControl);
            }
            
            // Create new routing control
            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(from[0], from[1]),
                    L.latLng(to[0], to[1])
                ],
                routeWhileDragging: false,
                showAlternatives: false,
                fitSelectedRoutes: true,
                lineOptions: {
                    styles: [
                        {color: '#4285F4', opacity: 0.8, weight: 6},
                        {color: 'white', opacity: 0.5, weight: 4}
                    ]
                },
                altLineOptions: {
                    styles: [
                        {color: '#4285F4', opacity: 0.4, weight: 6},
                        {color: 'white', opacity: 0.3, weight: 4}
                    ]
                },
                createMarker: function() { return null; } // Don't create extra markers
            }).addTo(map);
            
            // Process route information and display step-by-step directions
            routingControl.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                const instructions = routes[0].instructions;
                const distance = (summary.totalDistance / 1000).toFixed(1); // km
                const time = Math.round(summary.totalTime / 60); // minutes
                
                // Show the clear route button
                document.getElementById('clear-route').style.display = 'block';
                
                // Update the directions panel
                const directionsPanel = document.getElementById('directions-panel');
                const directionsSteps = document.getElementById('directions-steps');
                
                // Clear previous directions
                directionsSteps.innerHTML = '';
                
                // Set destination in header
                document.querySelector('.directions-title').textContent = `Directions to ${destinationName}`;
                
                // Add each step to the directions panel
                instructions.forEach((instruction, index) => {
                    if (instruction.type !== 'WaypointReached') {
                        const stepElement = document.createElement('div');
                        stepElement.className = 'direction-step';
                        
                        // Create step number icon
                        const stepIcon = document.createElement('div');
                        stepIcon.className = 'step-icon';
                        stepIcon.textContent = index + 1;
                        stepElement.appendChild(stepIcon);
                        
                        // Create step instruction
                        const stepInstruction = document.createElement('div');
                        stepInstruction.className = 'step-instruction';
                        stepInstruction.textContent = formatInstructions(instruction.text);
                        
                        // Add distance for this step
                        if (instruction.distance > 0) {
                            const stepDistance = document.createElement('div');
                            stepDistance.className = 'step-distance';
                            
                            // Format distance based on length
                            if (instruction.distance >= 1000) {
                                stepDistance.textContent = `${(instruction.distance / 1000).toFixed(1)} km`;
                            } else {
                                stepDistance.textContent = `${Math.round(instruction.distance)} m`;
                            }
                            
                            stepInstruction.appendChild(stepDistance);
                        }
                        
                        stepElement.appendChild(stepInstruction);
                        directionsSteps.appendChild(stepElement);
                    }
                });
                
                // Update total distance and time
                document.getElementById('total-distance').textContent = `${distance} km`;
                document.getElementById('total-time').textContent = `${time} min`;
                
                // Show the directions panel
                directionsPanel.style.display = 'block';
            });
            
            // Add a class to hide the default routing instructions
            const routingContainer = document.querySelector('.leaflet-routing-container');
            if (routingContainer) {
                routingContainer.classList.add('routing-control');
            }
        }
        
        // Clear route button
        document.getElementById('clear-route').addEventListener('click', function() {
            if (routingControl) {
                map.removeControl(routingControl);
                routingControl = null;
                this.style.display = 'none';
                
                // Hide directions panel
                document.getElementById('directions-panel').style.display = 'none';
            }
        });
        
        // Function to pan to a specific location
        function panToLocation(lat, lng) {
            map.panTo(new L.LatLng(lat, lng));
            
            // Find the matching location and open its popup
            for (let location of locations) {
                if (location.lat === lat && location.lng === lng) {
                    const locationName = location.name;
                    selectedDestination = {
                        latlng: [lat, lng],
                        name: locationName
                    };
                    if (markers[locationName]) {
                        markers[locationName].openPopup();
                        
                        // Show the directions button if user location is available
                        if (userPosition) {
                            setTimeout(() => {
                                const directionsBtn = document.querySelector('.directions-button');
                                if (directionsBtn) {
                                    directionsBtn.style.display = 'flex';
                                }
                            }, 100);
                        }
                    }
                    break;
                }
            }
        }
        
        // Search functionality
        document.querySelector('.search-button').addEventListener('click', function() {
            const searchTerm = document.querySelector('.search-box').value.toLowerCase();
            
            // Simple search implementation - find matching location
            const foundLocation = locations.find(location => 
                location.name.toLowerCase().includes(searchTerm)
            );
            
            if (foundLocation) {
                panToLocation(foundLocation.lat, foundLocation.lng);
            } else {
                alert('Location not found in Pansol area.');
            }
        });
        
        // Handle Enter key in search box
        document.querySelector('.search-box').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.querySelector('.search-button').click();
            }
        });
    </script>
</body>
</html>
